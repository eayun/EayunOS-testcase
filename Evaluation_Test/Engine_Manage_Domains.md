# 域控管理（Engine-Manage-Domains）

* 摘要
  * 实现了在EayunOS虚拟化管理中心里通过UI进行域控管理的操作，而不需要使用命令行操作。
  * 但为了能够使用，必须对其进行初始化。

## 域控管理的初始化

1. 以root身份SSH到EayunOS管理端虚拟机。
1. 执行命令`engine-manage-domains-setup`。
1. 提示`Setup proccess completed.`则说明初始化成功。
1. 在DNS中配置好对目录服务器的域名解析。

* 结果

  域控管理初始化成功，可以登录到EayunOS管理端在管理门户中进行操作。

## 域控管理的使用

1. 登录到EayunOS虚拟化管理中心，点击【域】选项卡。
1. 等待【刷新】按键刷新完毕后，可以使用。

  * 添加域（以FreeIPA为例）

  1. 点击菜单中的【新建】按键，在弹出的【Add Domain】对话框中，输入域，选择提供商，输入用户名、密码，你可以勾选【显示密码】以显示你所输入的密码，核对是否输入正确。
  1. 可以点击【高级参数】，展开高级配置选项，为所添加的用户添加权限等；如果你希望密码的设置更安全些，你可以选择使用密码文件，将文件的绝对路径填写在密码文件一栏中。
  1. 点击【Ok】，正在处理域的添加。
  1. 添加成功后，在列表中显示新添加的域的信息。
  1. 重启engine服务，在EayunOS管理端上运行`service ovirt-engine restart`。

  > #### 注意
  > 域添加成功后需要重启engine服务，才能添加的域生效。可以运行`service ovirt-engine restart`以重启engine服务。
  >   * 由于engine服务要被重启，如果你不希望HA服务将EayunOS管理端虚拟机重启，请在重启engine服务之前，启用全局维护模式。

  * 编辑域

  1. 在列表中点击要编辑的域的【编辑】按钮，在弹出的【Edit [domian_name]】对话框中，可以对域的密码、用户权限、配置文件等进行编辑。

  * 删除域

  1. 在列表中点击要删除的域的【删除】按钮。
  1. 弹出提示框询问是否确定删除，点击【确定】。

    * 结果

      域删除成功，列表中没有该域的信息。提示如下：

          [domain_name]已成功删除。
            * 请删除所有使用了管理门户或API的域的用户和组。
            * oVirt引擎需要重新启动，以更修改生效（service ovirt-engine restart）。

  > #### 注意
  > 域删除成功后需要重启engine服务，并且需要删除所有使用了管理门户或API的域的用户和组。可以运行`service ovirt-engine restart`以重启engine服务。
  >   * 由于engine服务要被重启，如果你不希望HA服务将EayunOS管理端虚拟机重启，请在重启engine服务之前，启用全局维护模式。

* 结果

  添加域成功后，可以使用该域中的用户，并为用户分配权限。
