# 高可用

|用例编号|测试目的|操作|预期结果|实际结果|备注|
|--------|--------|----|--------|--------|----|
|57      |配置虚拟机的高可用|<ul><li>前提：</li></ul><ol><li>配置电源管理禁用Cluster policy(设置为 None)虚拟机配置High Availability（只有服务器版 本的虚拟机可以配置）</li></ol><ul><li>操作：</li></ul><ol><li>登录系统，在左侧树形面板选择【展开所有】-\> 【系统】，在右侧详细面板菜单中选择【虚拟机】</li><li>点击菜单中的【编辑】，在【编辑虚拟机】对话框中，点击左侧的【高可用】选项卡，勾选【高度可用的】，配置运行/移植队列的优先级为【高】，点击【确定】以保存配置</li></ol>|<ol><li>看到虚拟机的【常规】子选项卡中，【高度可用的】显示为“是”，说明该虚拟机的高可用已经配置好</li><li>【优先权】显示为“高”，说明该虚拟机的高可用优先级是高</li></ol>|||
|58      |重启主机，测试虚拟机的高可用|<ul><li>前提条件：</li></ul><ol><li>集群中运行了高可用虚拟机的主机上配置了电源管理</li><li>集群中至少有一台可用的主机</li></ol><ul><li>操作：</li></ul><ol><li>在左侧树形面板中选择【虚拟机】，看集群中有哪些高可用虚拟机</li><li>在左侧树形面板中选择【主机】，选择运行了高可用虚拟机的主机（这台主机不能是运行着HostedEngine虚拟机的主机），点击菜单中的【电源管理】，在其下拉列表中点击【重启】</li><li>弹出【重启主机】窗口，确认是否重启主机，点击【确定】，主机重启，主机状态变化为Reboot -> Non Responsive -> Up</li><li>在主机状态变化到Non Responsive，点击【虚拟机】选项卡，观察高可用虚拟机的变化</li></ol>|能够看到高可用虚拟机在另一台可用主机上自动重启，虚拟机的状态变化为Down -> Powering Up -> Up，在另一台主机上正常运行|||
|59      |虚拟机中断情况下的高可用|<ol><li>在一台主机上运行多个虚拟机，并把其中一些设置为高可用</li><li>在这台上登录终端，使用vdsClient命令，运行<code>vdsClient -s 0 list table</li><li>列出运行在该主机上的虚拟机的id号、进程号、虚拟机名称及状态</li><li>根据虚拟机的进程id，使用“kill -9”杀掉虚 拟机进程</li></ol>|<ol><li>观察虚拟机列表，看到Engine管理端上的高可用虚拟机的状态变位Powering Up，事件提示为：“VM [VM_NAME] was restarted on Host [HOST_NAME]”</li><li>非高可用虚拟机处于Down状态</li></ol>|||
|60      |Non-Operational Host(Host是SPM)|<ol><li>查看storage网络的名字和物理接口</li><li>在【主机】选项卡中选择要操作的主机，点【网络接口】子选项卡，可以看到其至少有一个rhevm网络和一个storage网络</li><li>在树形面板中点击“ISCSI-share”，在【存储】选项卡中选择“ISCSI-share”，点击菜单中的【编辑】按键</li><li>在弹出的【编辑域】窗口中，点击【+】图标，显示iSCSI目标</li><li>通过ssh连接到host，使用ifconfig命令确认网络连接正常</li><li>根据storage网络的名字，用 ifdown命令关闭storage网络</li><li>由于host是SPM的，所以它会立刻自动重启</li><li>高可用虚拟机会在集群中其他可用主机启动，非高可用虚拟机会暂停</li><li>而一旦这台主机重新运行，原来运行在这台主机上的虚拟机会重新迁移回这台主机运行</li></ol>|虚拟机自动在另一台主机上运行，主机重新启动起来|||
|61      |Non-Operational Host（Host不是SPM）|<ol><li>操作步骤同host不是spm的情况</li><li>与SPM情况不同，主机上的所有虚拟机都会迁 移到其他主机上运行</li></ol>|虚拟机自动在另一台主机上运行|||
|62      |Non-responsive host（连接破坏）|<ol><li>在EayunOS虚拟化管理系统树形面板，点击【主机】，选择高可用虚拟机所在的主机，点击该主机，显示该主机的详细面板，点击【网络接口】，查看网卡名字（假设：eth1）</li><li>首先查看host的网络信息，然后使用ifdown命令关闭其网络（eth1）（注意，上一个case是 关闭storage网络）</li></ol>|<ol><li>高可用虚拟机会在其他主机上重新启动</li><li>非高可用虚拟机不会</li></ol>|||
|63      |Non-responsive host（不正确保护）|<ol><li>在【主机】选项卡中选择要操作的虚拟机，点击【电源管理】下拉菜单中的【重启】，来重启主机</li><li>主机重启完毕后，高可用虚拟机会立刻重新运行</li><li>在主机重启过程中，高可用虚拟机会在其它上运行</li><li>非高可用虚拟机会始终处于Down状态</li></ol>||||

**Note**<br /><br /> 其他注意事项：

