# 数据域的导入(可用于恢复备份)

## NFS数据域的导入
* 前提条件：有两个环境：Setup-Old、Setup-New；Setup-Old中有一个NFS数据域：Test-NFS；Setup-New中的数据中心已经初始化。
* 准备工作 - 虚拟机：
  * 登录到Setup-Old中，点击【虚拟机】标签，在右侧详细列表中，点击菜单中的【新建虚拟机】按键。
  * 在弹出的【新建虚拟机】标签中，输入虚拟机名称（必填）、描述和注释（选填），其他保持默认配置，点击【确定】。
  * 虚拟机新建完成后，弹出【添加虚拟磁盘】窗口，输入磁盘大小（本实验中填5G），选择存储域为Test-NFS，点击【确定】。
  * 虚拟机新建完成，该虚拟机是运行在Test-NFS数据域上的虚拟机。
* 准备工作 - 模板：
  * 登录到Setup-Old中，点击【虚拟机】标签，在右侧详细列表中，选择刚才新建的虚拟机，点击菜单中的【创建模板】或右键选择【创建模板】。
  * 在弹出的【新建虚模板】标签中，输入虚拟机名称（必填）、描述和注释（选填），其他保持默认配置，点击【确定】。
  * 模板新建完成，该模板是存储在Test-NFS数据域上的模板。
* 导入准备
  * 登录到Setup-Old中，点击【虚拟机】标签，关闭存储Test-NFS上的所有虚拟机。
  * 点击【存储】标签，选择存储Test-NFS，点击存储的【数据中心】子标签。
  * 点击子标签中的【维护】按键，维护该存储。
  * 存储维护成功后，点击子标签中的【分离】按键，将该存储从Setup-Old环境中分离。

### 导入数据域

1. 登录到Setup-New中，点击【存储】标签。
1. 点击【导入域】按键，在弹出的【导入配置的域】窗口中，选择域功能/存储类型为【Data/NFS】。
1. 在导出路径中填写Setup-Old中的Test-NFS的路径，点击【确定】。
1. Test-NFS被成功导入，在存储列表中看到Test-NFS存储域，状态变化为Locked -> Maintenance。
1. 点击选择该存储，看到存储的子标签中多了【虚拟机导入】和【模板导入】的子标签。
1. 在该存储的【数据中心】子标签中，点击【激活】按键，激活该存储，存储状态变化为Activing -> Active。

### 导入数据域中的实体

1. 点击选择所导入的存储域，点击子标签中的【虚拟机导入】按钮。
1. 在【虚拟机导入】子标签中，看到原本在Setup-Old环境中在此存储上创建的所有虚拟机的列表。
1. 点击选择其中一台虚拟机，点击子标签中的【导入】按键。
1. 点击【虚拟机】标签，看到列表中列出刚才导入的虚拟机，说明虚拟机成功导入。
1. 在【模板导入】子标签中，看到原本在Setup-Old环境中在此存储上创建的所有模板的列表。
1. 点击选择其中一个模板，点击子标签中的【导入】按键。
1. 点击【模板】标签，看到列表中列出刚才导入的模板，说明模板成功导入。

> ####注意
> 由于数据库中的设定，新建的虚拟机的数据要过60min才会同步到OVF_STORE中，所以，刚新建好的虚拟机是无法被导入的，因为数据没有被同步。

## iSCSI数据域的导入
* 前提条件：有两个环境：Setup-Old、Setup-New；Setup-Old中有一个iSCSI数据域：Test-iSCSI；Setup-New中的数据中心已经初始化。
* 准备工作 - 虚拟机：
  * 登录到Setup-Old中，点击【虚拟机】标签，在右侧详细列表中，点击菜单中的【新建虚拟机】按键。
  * 在弹出的【新建虚拟机】标签中，输入虚拟机名称（必填）、描述和注释（选填），其他保持默认配置，点击【确定】。
  * 虚拟机新建完成后，弹出【添加虚拟磁盘】窗口，输入磁盘大小（本实验中填5G），选择存储域为Test-iSCSI，点击【确定】。
  * 虚拟机新建完成，该虚拟机是运行在Test-iSCSI数据域上的虚拟机。
* 准备工作 - 模板：
  * 登录到Setup-Old中，点击【虚拟机】标签，在右侧详细列表中，选择刚才新建的虚拟机，点击菜单中的【创建模板】或右键选择【创建模板】。
  * 在弹出的【新建虚模板】标签中，输入虚拟机名称（必填）、描述和注释（选填），其他保持默认配置，点击【确定】。
  * 模板新建完成，该模板是存储在Test-iSCSI数据域上的模板。
* 导入准备
  * 登录到Setup-Old中，点击【虚拟机】标签，关闭存储Test-iSCSI上的所有虚拟机。
  * 点击【存储】标签，选择存储Test-iSCSI，点击存储的【数据中心】子标签。
  * 点击子标签中的【维护】按键，维护该存储。
  * 存储维护成功后，点击子标签中的【分离】按键，将该存储从Setup-Old环境中分离。

### 导入数据域

1. 登录到Setup-New中，点击【存储】标签。
1. 点击【导入域】按键，在弹出的【导入配置的域】窗口中，选择域功能/存储类型为【Data/iSCSI】。
1. 在【发现目标】 -> 【地址】中填写iSCSI存储的ip地址或FQDN，端口为3260（保持默认），点击【发现】。
1. 在【发现目标】下面的窗口中，列出该iSCSI域的所有target，Setup-Old中所使用的target，点击后面的登录图标，登录。
1. 在下方列出的target的LUN列表中，选择Setup-Old中所使用的LUN，点击【确定】。
1. Test-iSCSI被成功导入，在存储列表中看到Test-iSCSI存储域，状态变化为Locked -> Maintenance。
1. 点击选择该存储，看到存储的子标签中多了【虚拟机导入】和【模板导入】的子标签。
1. 在该存储的【数据中心】子标签中，点击【激活】按键，激活该存储，存储状态变化为Activing -> Active。

### 导入数据域中的实体

1. 点击选择所导入的存储域，点击子标签中的【虚拟机导入】按钮。
1. 在【虚拟机导入】子标签中，看到原本在Setup-Old环境中在此存储上创建的所有虚拟机的列表。
1. 点击选择其中一台虚拟机，点击子标签中的【导入】按键。
1. 点击【虚拟机】标签，看到列表中列出刚才导入的虚拟机，说明虚拟机成功导入。
1. 在【模板导入】子标签中，看到原本在Setup-Old环境中在此存储上创建的所有模板的列表。
1. 点击选择其中一个模板，点击子标签中的【导入】按键。
1. 点击【模板】标签，看到列表中列出刚才导入的模板，说明模板成功导入。

> #### 注意
> 由于数据库中的设定，新建的虚拟机的数据要过60min才会同步到OVF_STORE中，所以，刚新建好的虚拟机是无法被导入的，因为数据没有被同步。

### all in one环境中的存储恢复（导入本地存储）
