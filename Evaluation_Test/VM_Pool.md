# 虚拟机池

## 新建虚拟机池

### 基于根模板新建虚拟机池

1. 点击左侧树形面板中的【系统】，在右侧详细列表中点击【池】标签。
1. 点击菜单中的【新建】按键，在弹出的【新建池】窗口中，选择基于模板（本实验中选择Windows7_Template模板），输入池名称（必填）、描述和注释（选填），输入这个池中的虚拟机数量（本实验中填写6）、每个用户的最大虚拟机数目（本实验中填写2），其他配置可以保持默认配置，如果有需要可以修改相应配置。
1. 点击【确定】，虚拟机池开始创建。
1. 观察到详细列表中分配的虚拟机数量增加，直到增加到设置的虚拟机数量；在该池的【虚拟机】子标签下，看到虚拟机被依次创建，以【池名称-序号】命名，创建完毕后，虚拟机状态为Down。

### 基于子模板新建虚拟机池

## 分配UserRole权限给虚拟机池

1. 选择需要分配权限的虚拟机池，点击虚拟机池的【权限】子标签。
1. 点击菜单中的【添加】按键，在弹出的【添加权限给用户】窗口中，在搜索下选择域，输入用户名，点击【执行】。
1. 搜索结果会显示在列表中，勾选需要分配权限的用户，在窗口下方的【要分配的角色】下拉菜单中选择【UserRole】，点击【确定】。
1. 添加权限成功，在权限列表中显示用户及相应角色，该用户拥有访问虚拟机池的权限。

## 分配虚拟机
* 摘要
  在池里的虚拟机有相同的操作系统及安装的应用程序（因为他们是通过同一个模板创建的），池将分配同样的虚拟机给能够访问该池的每个用户。

1. 登录到用户门户，选择所创建的虚拟机池。
1. 点击该虚拟机池的绿色的【运行】图标，会显示【采用虚拟机】字样，此时从池中分配出一台虚拟机，并将该虚拟机运行，能够被用户使用。
1. 再次点击该虚拟机池的绿色的【运行】图标，会显示【采用虚拟机】字样，此时可以从池中再次分配一台虚拟机，能够被用户使用。
1. 此操作可重复，直至池中无虚拟机为止。
1. 池中的虚拟机是无状态的（stateless），因此对虚拟机所做的一些该变会在虚拟机关闭后销毁。

## 释放虚拟机

1 .登录到用户门户，记录虚拟机的名称，创建一个文件（本实验中创建一个文件，名为test.txt），点击红色的【关闭】图标，关闭虚拟机并将虚拟机释放，虚拟机返回虚拟机池。
1. 选择虚拟机池，再次点击绿色的【运行】图标，会显示【采用虚拟机】的字样，此时从池中分配出一台虚拟机，并将该虚拟机运行。
1. 该虚拟机可能不是原先关闭释放的虚拟机，请核对虚拟机名称。
1. 如果是之前关闭的虚拟机，打开该虚拟机，看到原本创建的文件已经被销毁。

## 分离虚拟机池中的虚拟机

1. 虚拟机池是无状态的虚拟机，可以从池中分离出来。
1. 在【池】标签下，点击选择要分离虚拟机的池，点击池的【虚拟机】子标签。
1. 选择要分离的虚拟机，点击子标签中的【分离】按键。
1. 在弹出的【分离虚拟机】确认框中，点击【确定】。
1. 虚拟机从池中分离出去，虚拟机不再是无状态的虚拟机。

## 删除虚拟机池

1. 按照以上步骤分离池中的虚拟机（如果想一次分离多台虚拟机，可以使用shift选择连续的或ctrl选择不连续的多台虚拟机，进行分离操作）。
1. 分离最后一台虚拟机时，弹出【分离虚拟机】确认框，在下方有提示：`注意：您选择了从池里删除所有虚拟机 - 这将把池自身也删除。`。
1. 点击【确定】，该虚拟机从池中分离，虚拟机池被删除，被分离的虚拟机显示在虚拟机列表中。
