# 虚拟机动态迁移

|用例编号|操作|预期结果|实际结果|备注|
|--------|----|--------|--------|----|
|15|虚拟机动态迁移从一个Host到另一个Host 前提：创建虚拟机时，设置 Host-\>Migration Options设置为“允许手动和自动迁 移”<br/><br/>1.  登录虚拟化系统，在左侧树形面板下点击 Expand<br/>    All,选择一个数据中心下指定集群， 点击VMs<br/><br/>2.  在虚拟机列表下选择一个或者多个虚拟机<br/>    （运行状态），点击菜单上的Migrate<br/><br/>3.  在“Migrate Virtual Machines”下选择“自动<br/>    选择主机”或“选择目标主机”点击OK<br/><br/>|虚拟机迁移成功（从一Host迁移到该集群下另一Host）|||
|16|虚拟机动态迁移从一个Host到另一个Host 前提：创建虚拟机时，设置Host-\>Migration Options 设置为“仅允许手动迁移”<br/><br/>1.  登录虚拟化系统，在左侧树形面板下点击 Expand<br/>    All,选择一个数据中心下指定集群， 点击VMs<br/><br/>2.  在虚拟机列表下选择一个或者多个虚拟机<br/>    （运行状态），点击菜单上的Migrate<br/><br/>3.  在“Migrate Virtual Machines”下选择“自动<br/>    选择主机”或“选择目标主机”点击OK<br/><br/>|虚拟机迁移成功（从一Host迁移到该集群下另一Host）|||
|17|虚拟机动态迁移从一个Host到另一个Host 前提：创建虚拟机时，设置Host-\>Migration Options 设置为“不允许迁移”<br/><br/>1.  登录虚拟化系统，在左侧树形面板下点击 Expand<br/>    All,选择一个数据中心下指定集群， 点击VMs<br/><br/>2.  在虚拟机列表下选择一个或者多个虚拟机<br/>    （运行状态），点击菜单上的Migrate<br/><br/>3.  在“Migrate Virtual Machines”下选择“自动<br/>    选择主机”或“选择目标主机”点击OK<br/><br/>|虚拟机没有迁移提示不能迁移|||
|18|当Host变为维护模式时，虚拟机自动动态迁移到其他 Host 前提：创建虚拟机时，设置 Host-\>Migration Options设置为“允许手动和自动迁 移”<br/><br/>1.  登录虚拟化系统，在左侧树形面板下点击 Expand<br/>    All，选择一个数据中心下指定集群 下的Hosts<br/><br/>2.  在Hosts列表下选择其中一个Host，点击菜单<br/>    Maintenance，该Host变为维护模式<br/><br/>3.  检查该集群下创建在该Host下的虚拟机是否 自动迁移到该集群下其他Host上<br/><br/>|虚拟机自动迁移|||
|19|当Host变为维护模式时，虚拟机自动动态迁移到其他 Host 前提：创建虚拟机时，设置 Host-\>Migration Options设置为“仅允许手动迁移”<br/><br/>1.  登录虚拟化系统，在左侧树形面板下点击 Expand<br/>    All，选择一个数据中心下指定集群 下的Hosts<br/><br/>2.  在Hosts列表下选择其中一个Host，点击菜单<br/>    Maintenance，试图将该Host变为维护模式<br/><br/>|Host不能变为维护模式，提示该Host上有不能迁移的 虚拟机|||
|20|当Host变为维护模式时，虚拟机自动动态迁移到其他 Host 前提：创建虚拟机时，设置 Host-\>Migration Options设置为“不允许迁移”<br/><br/>1.  登录虚拟化系统，在左侧树形面板下点击 Expand<br/>    All，选择一个数据中心下指定集群 下的Hosts<br/><br/>2.  在Hosts列表下选择其中一个Host，点击菜单<br/>    Maintenance，试图将该Host变为维护模式<br/><br/>3.  |Host不能变为维护模式，提示该Host上有不能迁移的 虚拟机|||
|21|定义 Cluster power saving policy-\>Evenly\_Distributed 虚拟机动态迁移 （CpuOverCommitDurationMinutes(0,10)） 虚拟机动态迁移（HighUtilization[50,99]）<br/><br/>1.  定义集群策略，CpuOverCommitDurationMinutes设置为2（0,10），HighUtilization<br/>    50[50,99]<br/><br/>2.  在一台主机上同时启多台虚拟机（允许手动和自动迁移），同时虚拟机上运行消耗CPU的程序（如：echo<br/>    "scale=100000;4\*a(1)"|bc -l）<br/><br/>3.  观察主机CPU使用情况达到50%([50,99])及以上时，时间为2([1,9])分钟，虚拟机作何反应<br/><br/>|时间到达2分钟后，虚拟机开始自动迁移|||
|22|定义Cluster power saving policy-\>Power\_Saving虚 拟机动态迁移 （CpuOverCommitDurationMinutes(0,10)）<br/><br/>1.  选择集群，右键编辑集群，设置CpuOverCommitDurationMinutes为2<br/><br/>2.  在node的vm上面跑程序，使得满足自动迁移的条件。<br/><br/>|2分钟之后开始迁移。|||
|23|定义Cluster power saving policy-\>Power\_Saving虚 拟机动态迁移（HighUtilization[50,99]）<br/><br/>1.  选择集群，右键编辑集群，设置highUtilization80。<br/><br/>2.  在node2上面运行几个vm，总CPU占用率超过80%，单个vm占用率不超过。node1的CPU占用率大于20（下限），低于80%。<br/><br/>|一段时间后，部分虚拟机被迁移到node1。|||
|24|定义Cluster power saving policy-\>Power\_Saving虚 拟机动态迁移（LowUtilization[10,49]）<br/><br/>1.  选择集群，右键编辑集群，设置lowUtilization为10<br/><br/>2.  在集群中node1上任意虚拟机跑程序，使cpu占用率大于10%<br/><br/>3.  将node2上关闭或者打开一些虚拟机，保证node2上存在虚拟机，且cpu占用率低于10%。<br/><br/>4.  如果node2上的虚拟机迁移到node1上面了，手动迁移回来。<br/><br/>|当node2的cpu占用率低于10%，虚拟机自动迁移到node1,如果手动移动回node2,需要一段时间后才会重新检测，然后再迁移。|||

