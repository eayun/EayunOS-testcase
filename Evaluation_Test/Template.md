# 模板的创建和使用

## 创建模板

* 创建EL7虚拟机模板

1. 选择一台EL7的虚拟机，点击菜单中的关闭图标或右键选择【关闭】，关闭该虚拟机，虚拟机状态变化为Powering Down -> Down。
1. 选择这台虚拟机，点击菜单中的【创建模板】按键或右键选择【创建模板】。
1. 在弹出的【新建模板】窗口中，输入模板的名称（必填，本实验中名称为EL7）、描述和注释（选填），勾选【复制虚拟机权限】，其他保持默认配置，点击【确定】。
1. 虚拟机的模板创建成功后，该虚拟机的状态变化为image Locked -> Down，磁盘状态变化为Locked -> Up。
1. 模板的磁盘状态为Locked -> Up。

  * 结果

    基于EL7虚拟机的模板创建成功，可以使用改模板创建虚拟机。

* 创建EL7模板的子版本

  * 前提：已经基于该EL7模板创建了一台虚拟机。

1. 选择一台以EL7模板创建的虚拟机，点击控制台，打开虚拟机控制台窗口，为这台虚拟机安装vim（本实验以安装vim为例）。
1. 关闭控制台窗口，点击菜单中的关闭图标或右键选择【关闭】，关闭该虚拟机，虚拟机状态变化为Powering Down -> Down。
1. 选择这台虚拟机，点击菜单中的【创建模板】按键或右键选择【创建模板】。
1. 在弹出的【新建模板】窗口中，勾选【创建为子模板版本】，在增加的信息中选择根模板为创建该虚拟机时所使用的模板。
1. 输入子版本名称，勾选【复制虚拟机权限】，存储分配保持默认配置，点击【确定】。
1. 虚拟机模板的子模板创建成功后，该虚拟机的状态变化为image Locked -> Down，磁盘状态变化为Locked -> Up。
1. 模板的磁盘状态为Locked -> Up。

  * 结果

    EL7模板的子版本创建成功，该模板基于EL7，但安装了vim。


## 使用模板

* 创建基于EL7模板的虚拟机

1. 登录到Engine管理端，点击左侧树形界面中的【展开所有】，在默认集群的Default下，点击虚拟机，在右侧的虚拟机列表中，点击菜单中的【新建虚拟机】按键。
1. 在弹出的【新建虚拟机】窗口中，选择基于模板【EL7】，输入虚拟机名称（必填）、描述和注释（选填），点击【确定】。
1. 虚拟机创建成功，状态变化为image Locked -> Up，其磁盘状态变化为Locked -> Up。

  * 结果

    基于EL7模板的虚拟机创建成功。

* 使用EL7模板的某个子版本创建虚拟机池

1. 点击【池】选项卡，点击菜单中的【新建】按键。
1. 在打开的【新建池】窗口中，【基于模板】选择模板的根模板，【模板子版本】选择要用的模板的某个子版本（本实验选择安装了vim的子版本）。
1. 输入池名称、描述和注释，设置虚拟机的数量、每个用户的最大虚拟机数，其他选项保持默认配置，点击【确定】。
1. 虚拟机池创建成功，虚拟机池中的虚拟机是基于模板的子版本的。
1. 点击选择池中的一台虚拟机，运行该虚拟机，验证是否安装了vim。

  * 结果

    该虚拟机是基于EL7模板的安装了vim的子模板所创建的，创建的虚拟机池中的虚拟机安装了vim。

> #### 注意
> 使用EL7模板的某个子版本创建单台虚拟机的效果与创建虚拟机池是一样的，在这里不再赘述。

* 使用EL模板的最新版本创建虚拟机池

1. 点击【池】选项卡，点击菜单中的【新建】按键。
1. 在打开的【新建池】窗口中，【基于模板】选择模板的根模板，【模板子版本】选择【最新的】。
1. 输入池名称、描述和注释，置虚拟机的数量、每个用户的最大虚拟机数，其他选项保持默认配置，点击【确定】。
1. 点击运行池的其中一台虚拟机Vm-A，在该虚拟机上安装vim（原本模板中没有安装vim）。
1. 关闭这台虚拟机Vm-A，点击【创建模板】，创建子模板（过程可参上述创建子模板的过程）。
1. 模板创建完毕后，启动池中的另一台虚拟机Vm-B，观察该虚拟机的情况。
1. 看到该虚拟机Vm-B中已经安装了vim。

> #### 注意
> 如果选择【最新的】，则每次启动虚拟机池中的虚拟机，都会自动启用最新版本的模板。

> #### 注意
> 使用EL模板的最新模板创建单台虚拟机的过程与创建虚拟机池相同，但是单台虚拟机**不会**在每次启动时都使用模板的最新版本。

