# 导入存储域

* 导入NFS存储域

|用例编号|测试目的|操作|预期结果|实际结果|备注|
|--------|--------|----|--------|--------|----|
|1       |导入NFS存储域前的准本|<ul><li>前提条件：</ul></li><ol><li>有两个环境：Setup-Old、Setup-New</li><li>Setup-Old中有一个NFS数据域：Test-NFS；Setup-New中的数据中心已经初始化</li></ol><ol><li>登录到Setup-Old中，点击【虚拟机】标签，在右侧详细列表中，点击菜单中的【新建虚拟机】按键</li><li>在弹出的【新建虚拟机】标签中，输入虚拟机名称（必填）、描述和注释（选填），其他保持默认配置，点击【确定】</li><li>虚拟机新建完成后，弹出【添加虚拟磁盘】窗口，输入磁盘大小（本实验中填5G），选择存储域为Test-NFS，点击【确定】</li><li>登录到Setup-Old中，点击【虚拟机】标签，在右侧详细列表中，选择刚才新建的虚拟机，点击菜单中的【创建模板】或右键选择【创建模板】</li><li>在弹出的【新建虚模板】标签中，输入虚拟机名称（必填）、描述和注释（选填），其他保持默认配置，点击【确定】</li></ol>|<ol><li>虚拟机新建完成，该虚拟机是运行在Test-NFS数据域上的虚拟机</li><li>点击Test-NFS存储域的【虚拟机】子标签，可以看到新建的虚拟机<li>模板新建完成，该模板是存储在Test-NFS数据域上的模板</li><li>点击Test-NFS存储域的【模板】子标签，可以看到新建的模板</li></ol>||
|2       |导入准备：分离存储域|<ol><li>登录到Setup-Old中，点击【虚拟机】标签，关闭存储Test-NFS上的所有虚拟机</li><li>点击【存储】标签，选择存储Test-NFS，点击存储的【数据中心】子标签</li><li>点击子标签中的【维护】按键，维护该存储</li><li>存储维护成功后，点击子标签中的【分离】按键，将该存储从Setup-Old环境中分离</li></ol>|存储成功从Setup-Old中分离，看到存储域前面的图标是分离的图标||
|3       |导入NFS数据域|<ol><li>登录到Setup-New中，点击【存储】标签</li><li>点击【导入域】按键，在弹出的【导入配置的域】窗口中，选择域功能/存储类型为【Data/NFS】</li><li>在导出路径中填写Setup-Old中的Test-NFS的路径，点击【确定】</li><li>存储域导入后，点击选择该存储域，在存储域的【数据中心】子标签中，点击菜单中的【激活】按键，激活存储域</li></ol>|存储域导入成功<br /><br /><ol><li>Test-NFS被成功导入，在存储列表中看到名称为Test-NFS的存储域，状态变化为Locked -> Maintenance</li><li>点击选择该存储，看到存储的子标签中多了【虚拟机导入】和【模板导入】的子标签</li><ol>||由于数据库中的设定，新建的虚拟机的数据要过60min才会同步到OVF_STORE中，所以，刚新建好的虚拟机是无法被导入的，因为数据没有被同步，因此会出现【虚拟机导入】标签和【模板导入】标签为空或不出现的情况|
|4       |导入NFS数据域中的实体|<ol><li>点击选择所导入的存储域，点击子标签中的【虚拟机导入】按钮</li><li>在【虚拟机导入】子标签中，看到原本在Setup-Old环境中在此存储上创建的所有虚拟机的列表</li><li>点击选择其中一台虚拟机，点击子标签中的【导入】按键</li><li>在【模板导入】子标签中，看到原本在Setup-Old环境中在此存储上创建的所有模板的列表</li><li>点击选择其中一个模板，点击子标签中的【导入】按键</li></ol>|<ul><li>成功导入：</li></ul><br /><ol><li>点击【虚拟机】标签，看到列表中列出刚才导入的虚拟机，说明虚拟机成功导入</li><li>点击【模板】标签，看到列表中列出刚才导入的模板，说明模板成功导入</li><li>当所有的虚拟机和模板导入完成后，刷新页面，存储中的【虚拟机导入】和【模板导入】子标签消失</li></ol><br /><ul><li>未能成功导入：</li></ul><ol><li>点击【虚拟机导入】子标签，选择一台虚拟机，这台虚拟机有两个磁盘，一个磁盘是基于该存储创建的，而另一个磁盘属于Setup-Old中的另一个存储，点击子标签菜单中的【导入】按键，提示：执行时出错：无法导入VM。存储域不存在</li><li>点击【模板导入】子标签，选择一个基于上述描述的虚拟机所创建的模板，点击子标签菜单中的【导入】按键，提示：执行时出错：无法导入VM。存储域不存在</li></ol>|如果虚拟机的磁盘不完全属于被导入的存储Test-NFS，则虚拟机无法成功导入，因为这台虚拟机时不完整的；对于模板的情况，同理|

* 导入iSCSI存储域

|用例编号|测试目的|操作|预期结果|实际结果|备注|
|--------|--------|----|--------|--------|----|
|1       |导入iSCSI存储域前的准本|<ul><li>前提条件：</ul></li><ol><li>有两个环境：Setup-Old、Setup-New</li><li>Setup-Old中有一个iSCSI数据域：Test-iSCSI；Setup-New中的数据中心已经初始化</li></ol><ol><li>登录到Setup-Old中，点击【虚拟机】标签，在右侧详细列表中，点击菜单中的【新建虚拟机】按键</li><li>在弹出的【新建虚拟机】标签中，输入虚拟机名称（必填）、描述和注释（选填），其他保持默认配置，点击【确定】</li><li>虚拟机新建完成后，弹出【添加虚拟磁盘】窗口，输入磁盘大小（本实验中填5G），选择存储域为Test-iSCSI，点击【确定】</li><li>登录到Setup-Old中，点击【虚拟机】标签，在右侧详细列表中，选择刚才新建的虚拟机，点击菜单中的【创建模板】或右键选择【创建模板】</li><li>在弹出的【新建虚模板】标签中，输入虚拟机名称（必填）、描述和注释（选填），其他保持默认配置，点击【确定】</li></ol>|<ol><li>虚拟机新建完成，该虚拟机是运行在Test-iSCSI数据域上的虚拟机</li><li>点击Test-iSCSI存储域的【虚拟机】子标签，可以看到新建的虚拟机<li>模板新建完成，该模板是存储在Test-iSCSI数据域上的模板</li><li>点击Test-iSCSI存储域的【模板】子标签，可以看到新建的模板</li></ol>||
|2       |导入准备：分离存储域|<ol><li>登录到Setup-Old中，点击【虚拟机】标签，关闭存储Test-iSCSI上的所有虚拟机</li><li>点击【存储】标签，选择存储Test-iSCSI，点击存储的【数据中心】子标签</li><li>点击子标签中的【维护】按键，维护该存储</li><li>存储维护成功后，点击子标签中的【分离】按键，将该存储从Setup-Old环境中分离</li></ol>|存储成功从Setup-Old中分离，看到存储域前面的图标是分离的图标||
|3       |导入iSCSI数据域|<ol><li>登录到Setup-New中，点击【存储】标签</li><li>点击【导入域】按键，在弹出的【导入配置的域】窗口中，选择域功能/存储类型为【Data/iSCSI】</li><li>在【发现目标】 -> 【地址】中填写iSCSI存储的ip地址或FQDN，端口为3260（保持默认），点击【发现】</li><li>在【发现目标】下面的窗口中，列出该iSCSI域的所有target，Setup-Old中所使用的target，点击后面的登录图标，登录</li><li>在下方列出的target的LUN列表中，选择Setup-Old中所使用的LUN，点击【确定】</li><li>存储域导入后，点击选择该存储域，在存储域的【数据中心】子标签中，点击菜单中的【激活】按键，激活存储域</li></ol>|存储域导入成功<br /><br /><ol><li>Test-iSCSI被成功导入，在存储列表中看到名称为Test-iSCSI的存储域，状态变化为Locked -> Maintenance</li><li>点击选择该存储，看到存储的子标签中多了【虚拟机导入】和【模板导入】的子标签</li><ol>||由于数据库中的设定，新建的虚拟机的数据要过60min才会同步到OVF_STORE中，所以，刚新建好的虚拟机是无法被导入的，因为数据没有被同步，因此会出现【虚拟机导入】标签和【模板导入】标签为空或不出现的情况|
|4       |导入iSCSI数据域中的实体|<ol><li>点击选择所导入的存储域，点击子标签中的【虚拟机导入】按钮</li><li>在【虚拟机导入】子标签中，看到原本在Setup-Old环境中在此存储上创建的所有虚拟机的列表</li><li>点击选择其中一台虚拟机，点击子标签中的【导入】按键</li><li>在【模板导入】子标签中，看到原本在Setup-Old环境中在此存储上创建的所有模板的列表</li><li>点击选择其中一个模板，点击子标签中的【导入】按键</li></ol>|<ul><li>成功导入：</li></ul><ol><li>点击【虚拟机】标签，看到列表中列出刚才导入的虚拟机，说明虚拟机成功导入</li><li>点击【模板】标签，看到列表中列出刚才导入的模板，说明模板成功导入</li><li>当所有的虚拟机和模板导入完成后，刷新页面，存储中的【虚拟机导入】和【模板导入】子标签消失</li></ol><br /><ul><li>未能成功导入：</li></ul><ol><li>点击【虚拟机导入】子标签，选择一台虚拟机，这台虚拟机有两个磁盘，一个磁盘是基于该存储创建的，而另一个磁盘属于Setup-Old中的另一个存储，点击子标签菜单中的【导入】按键，提示：执行时出错：无法导入VM。存储域不存在</li><li>点击【模板导入】子标签，选择一个基于上述描述的虚拟机所创建的模板，点击子标签菜单中的【导入】按键，提示：执行时出错：无法导入VM。存储域不存在</li></ol>|如果虚拟机的磁盘不完全属于被导入的存储Test-iSCSI，则虚拟机无法成功导入，因为这台虚拟机时不完整的；对于模板的情况，同理|
