# 添加外部供应商
| **编号** | **测试项** | **测试目的** | **测试步骤** | **预期结果** | **实际结果** |
|--------- | ---------- | ------------ | ------------ | ------------ | ------------ |
|**0020500**|添加 'ifacemacspoof' 属性|使得通过该端口的网络数据包不被 ebtables 所阻挡|1.ssh连接到engine所在的虚拟机，执行以下命令来设置虚拟机某个特定网络接口的自定义属性：```engine-config -s "CustomDeviceProperties={type=interface;prop={ifacemacspoof=^(true|false)$}}"```<br/>2.使用以下命令检查该自定义属性是否添加成功：```engine-config -g CustomDeviceProperties```<br/>3.重启ovirt-engine服务：```service ovirt-engine restart```|添加 'ifacemacspoof' 属性成功||
|**0020501**|添加新的虚拟机网络 neutron|若虚拟机要使用外部网络，则neutron网络必须在运行该虚拟机的主机上进行配置 |1. 在**网络**标签下，点击**新建**，打开**新建逻辑网络**窗口。<br/>2.选择**数据中心**，输入逻辑网络**名称** 'neutron'，在**集群**标签页中选择要附加到的集群和是否是必需的，vNIC 配置集名称为 'neutron'。<br/>3.点击**确定**。<br/>4.在该逻辑网络的详请面板中选择 **vNIC 配置集**标签，编辑 neutron 这个vNIC 配置集，打开**虚拟机接口配置集**窗口。<br/>5.在**请选择密钥**下拉菜单中选 **ifacemacspoof** ,在后面的文本框中输入 **true** 。<br/>点击**确定**。|设置逻辑网络 neutron 的 vNIC 配置集自定义属性成功||
|**0020502**|在运行了使用外部网络的虚拟机的主机上配置 neutron 逻辑网络|使运行在该主机上的虚拟机可以使用该逻辑网络|1.选择要配置 neutron 逻辑网络的主机，在详情面板上选择**网络接口**。<br/>2.点击**设立主机网络**，打开**设置主机xx的网络**窗口，将 neutron 逻辑网络与相应的接口相关联。<br/>3.勾选**检验主机和 ovirt-engine 间的连接性**选择框和**保存网络配置**选择框。<br/>4.点击**确定**。|设立主机网络成功||
|**0020503**|将外部供应闪glance中的 Neutron 应用器件镜像作为一个模板导入|为基于 Neutron 应用器件创建虚拟机做准备|1.点击**存储**标签页，选择默认的glance外部供应商，在详细面板中的映像标签下的列表中选择 **Neutron Appliance**，点击**导入**，打开**导入映像**窗口。<br/>2.在**数据中心**下拉菜单中选择数据中心，在**域名**下拉菜单中选择存储域，在**配额**下拉菜单中选择配额（如果配置过配额），勾选**作为模板导入**选择框。<br/>3.点击**确定**，导入映像开始。|导入 Neutron 应器件成功。|实际并没有作为模板导入，只是以磁盘的形式，同issue#26，测试用例070404|
|**0020504**|基于 Neutron 应用器件镜像创建虚拟机 |提供 OpenStack 外部网络供应商 |1.新建一个虚拟机，在引导操作下配置虚拟磁盘，打开**添加虚拟磁盘**窗口，点击**附加磁盘**选择框。<br/>2.在**内部的**磁盘列表中选择导入的 Neutron 应用器件镜像，勾选**激活**选择框。<br/>3.点击**确定**。<br/>4.为该虚拟机添加两个虚拟网卡，配置集分别是**eayunosmgmt**和**neutron**。<br/>5.在运行该虚拟机的主机上安装vdsm 的 macspoof hook： ```yum -y install vdsm-hook-macspoof```<br/>6.选择该虚拟机，右键选择**只运行一次**，打开运行虚拟机窗口。<br/>7.点击**初始运行**，勾选**使用 Cloud-Init** 选择框。<br/>8.点击**验证**，输入**用户名**，如'root';输入**密码**和**验证密码**（二者必须相同）。<br/>9.点击**网络**，勾选**网络**选择框，点击'+'新增一个网络接口，在右边文本框中输入网络接口名称'eth0'，选择协议为 **static**，并配置ip、子网掩码和网关（该网络接口将连接到 eayunosmgmt），勾选**引导时启动**选择框。再点击'+'新增一个网络接口，在右边文本框中输入网络接口名称'eth1'，选择协议为 **none** （该网络接口将连接到 neutron），勾选**引导时启动**选择框。<br/>10.点击**确定**运行该虚拟机（使用 cloud-init 大约 4 分钟虚拟机启动完成）。<br/>11.ssh连接至该虚拟机，运行以下命令确认OpenStack 服务正在运行：<br/>```# sudo -i ```<br/> ```. /root/keystonerc_admin```<br/>``` openstack-status```<br/>12.为neutron用户在keystone中配置新密码（替换应用器件中已配置的默认 Neutron 服务密码）：<br/>```. /root/keystonerc_admin```<br/>```keystone user-password-update neutron```<br/>13.编辑 /etc/neutron/neutron.conf 设置 admin_password 为新配置的密码并重启 Neutron 服务：```# openstack-service restart neutron-server```|虚拟机正常运行，Openstack服务也正常与进行 ||
|**0020505**|在 engine 中配置 Neutron 网络提供商|配置外部网络供应商|1.ssh到engine所在的虚拟机上，运行以下命令:``` engine-config -s KeystoneAuthUrl=http://NEUTRON_SERVER_IP_ADDRESS:35357/v2.0/ ```<br/>2.重启 ovirt-engine 服务：```service ovirt-engine restart```<br/>3.在树形模式下点击**外部供应商**，点击**添加**，打开**添加供应商**窗口。<br/>4.输入**名称**、**描述**，选择**类型**'Openstack Networking'。<br/>5.**网络插件**为 Open vSwitch。**供应商 URL** 填写：http://NEUTRON_SERVER_IP_ADDRESS:9696。<br/>6.勾选**要求验证选择框**，**用户名**填写：neutron；**密码**为neutron用户在keystone中配置新密码；**Tenant** 名称为 services。<br/>7.点**代理配置**，在**接口映射**文本框中输入 vmnet:br-neutron；**Broker类型**：RabbitMQ ； **主机**：NEUTRON_SERVER_IP_ADDRESS ； **端口**：5672；**用户名**：guest；**密码**：guest<br/>8.点击**确定**。|添加外部网络供应商成功||
