# 新建 Affinity 组

| **用例编号** | **测试目的** | **测试步骤** | **预期结果** | **实际结果** | **备注** |
| ------------ | ------------ | ------------ | ------------ | ------------ | -------- |
| 0080500 | 验证【名称】输入框中只可包含字母 **'.'**，**'_'** 或 **'-'** 字符。 | 1. 点击【虚拟机】标签，选择一台虚拟机。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入**关联组!@#$%^&*() ?><}{":**，点击**确定**。 | 【新建 Affinity】窗口没有关闭，且【名称】旁边的输入框变成红色，将鼠标移入输入框中，会显示 **名称只包含字母数字字符( UTF 支持的任何语言, 包括 RTL 语言), 数字, '.','_' 或 '-' 字符** | 与预期结果一致。 | |
| 0080501 | 验证【名称】输入框中只可包含 254 个字符。 | 1. 点击【虚拟机】标签，选择一台虚拟机。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入 254 个字符，点击【确定】。 | 【新建 Affinity】窗口自动关闭，在关联组列表中存在刚刚创建的关联组。 | 会弹出【操作被取消】这个窗口并报错：Error while executing action AddAffinityGroup: Internal Engine Error。 | 见 https://github.com/eayun/ovirt-engine/issues/45 |
| 0080502 | 验证【描述】输入框中只可包含遵循了标准 ASCII 字符集的字母数字字符和特殊字符。 | 1. 点击【虚拟机】标签，选择一台虚拟机。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【描述】旁边的输入框中输入 **！@#￥%……&*（的の**，点击【确定】。 | 【新建 Affinity】窗口没有关闭，且【名称】旁边的输入框变成红色，将鼠标移入输入框中，会显示 **只允许遵循了标准 ASCII 字符集的字母数字字符和特殊字符 | 与预期结果一致。如果输入的是英文输入法下的特殊字符（例如：**!@#$%^&**），是可以被接受的。 | |
| 0080503 | 验证同一个关联组下的虚拟机的【Affinity 组】子标签下的关联组列表中中都具有该关联组。 | 1. 点击【虚拟机】标签，选择一台虚拟机。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 输入响应的【名称】和【描述】后，勾选【Positive】来和其它的虚拟机进行关联。<br/>4. 点击【+】按扭，选择要与该虚拟机进行关联的虚拟机 （此步骤可重复多次），点击【确定】。 | 到各个被关联的虚拟机的 【Affinity】 组中查看到列表中确实有刚刚创建的那个 Affinity 组。 | 与预期结果一致。 |
| 0080504 | 在不考虑主机内存，CPU 使用紧张的情况下，验证具有【Positive + Hard Enforcement】属性关联组下的两台虚拟机，其中一台运行在【主机A】上，将另一台正处于关闭状态且可迁移的虚拟机设置为在【主机B】下开启，但其开启后会在【主机A】上运行。 | 1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 勾选 【Positive】 和 【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择【虚拟机b】，点击【确定】。<br/>6. 编辑【虚拟机b】，在左侧的标签栏中选择【主机】，点击【专有的】，选择【主机B】，点击【确定】。<br/>7. 开启【虚拟机b】。 | 虚拟机均在同一台主机，即【主机A】上开启。 | 与预期结果一致。 |
| 0080505 | 在不考虑主机内存，CPU 使用紧张的情况下，验证具有【Positive + Soft Enforcement】属性关联组下的两台虚拟机，其中一台运行在【主机A】上，将另一台正处于关闭状态且可迁移的虚拟机设置为在【主机B】下开启，其结果确实是在【主机B】中开启的。 | 1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 只勾选 【Positive】，不勾选【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择【虚拟机b】，点击【确定】。<br/>6. 编辑【虚拟机b】，在左侧的标签栏中选择【主机】，点击【专有的】，选择【主机B】，点击【确定】。<br/>7. 开启【虚拟机b】。 | 【虚拟机b】并没有在【主机A】上开启，而是在【主机B】上成功开启。 | 与预期结果一致。 | 
| 0080506 | 在不考虑主机内存，CPU 使用紧张的情况下，验证具有【Negative + Hard Enforcement】属性关联组下有两台虚拟机，其中一台运行在【主机A】上，将另一台正处于关闭状态且为可迁移的虚拟机设置为在【主机A】下开启，其结果是【虚拟机b】在另外一台主机上开启，而不是【主机A】上。 | 1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 不勾选 【Positive】，只勾选 【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择【虚拟机b】，点击【确定】。<br/>6. 编辑【虚拟机b】，在左侧的标签栏中选择【主机】，点击【专有的】，选择【主机A】，点击【确定】。<br/>7. 开启【虚拟机b】。 | 【虚拟机b】并没有在【主机A】上开启，而是在另一台主机上成功开启。 | 与预期结果一致。 |
| 0080507 | 在不考虑主机内存，CPU 使用紧张的情况下，验证具有【Negative + Soft Enforcement】属性关联组下的两台虚拟机，其中一台运行在【主机A】上，将另一台正处于关闭状态且可迁移的虚拟机设置为在【主机A】上开启，其结果是【虚拟机b】在【主机A】上成功开启。 | 1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 不勾选 【Positive】 和 【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择【虚拟机b】，点击【确定】。<br/>6. 编辑【虚拟机b】，在左侧的标签栏中选择【主机】，点击【专有的】，选择【主机A】，点击【确定】。<br/>7. 开启【虚拟机b】。 | 【虚拟机b】并没有在其它非【主机A】上开启，而是在【主机A】上成功开启。 | 与预期结果一致。 |
| 0080508 | 在不考虑主机内存，CPU 使用紧张等的情况下，验证具有【Positive + Hard Enforcement】属性关联组下有两台虚拟机，其中一台运行在【主机A】上，将另一台正处于关闭状态且不可迁移的虚拟机设置为在【主机B】下开启，但是开启该虚拟机后会报错。 | 1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 勾选 【Positive】 和 【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择【虚拟机b】，点击【确定】。<br/>6. 编辑【虚拟机b】，在左侧的标签栏中选择【主机】，点击【专有的】，选择【主机B】。点击【迁移选项】的下拉菜单，选择【不允许迁移】。点击【确定】。<br/>7. 开启【虚拟机b】。 | 此时会弹出【！操作被取消】的窗口，其内容是：<br/>执行动作时出错：vm_b：<ul><li>无法运行虚拟机。没有满足当前调度约束的主机。请查看下面的细节：</li><li>主机 【host_B】 不满足 internal 过滤器 VmAffinityGroups，原因是不匹配关联规则 。</li><li>主机 【host_A】 不满足 internal 过滤器 PinToHost。</li></ul> | 与预期结果一致。 |
| 0080509 | 在不考虑主机内存，CPU 使用紧张的情况下，验证具有【Positive + Soft Enforcement】属性关联组的两台虚拟机，其中一台运行在【主机A】上，将另一台正处于关闭状态且不可迁移的虚拟机设置为在【主机B】下开启，其结果确实在【主机B】中成功开启。后有可能不在同一台主机上运行。 | 1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 勾选 【Positive】 和 【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择【虚拟机b】，点击【确定】。<br/>6. 编辑【虚拟机b】，在左侧的标签栏中选择【主机】，点击【专有的】，选择【主机B】。点击【迁移选项】的下拉菜单，选择【不允许迁移】。点击【确定】。<br/>7. 开启【虚拟机b】。<br/> | 【虚拟机b】并没有在【主机A】上开启，而是在【主机B】上成功开启。 | 与预期结果一致。 | 
| 0080510 | 在不考虑主机内存，CPU 使用紧张的情况下，验证具有【Negative + Hard Enforcement】属性关联组下的两台虚拟机，其中一台正运行在【主机A】上，将另一台正处于关闭状态且不可迁移的虚拟机设置为在【主机A】下开启，但是开启该虚拟机的时候会报错。 | 1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 不勾选 【Positive】，只勾选 【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择【虚拟机b】，点击【确定】。<br/>6. 编辑【虚拟机b】，在左侧的标签栏中选择【主机A】，点击【专有的】，选择【主机A】。点击【迁移选项】的下拉菜单，选择【不允许迁移】。点击【确定】。<br/>7. 开启【虚拟机b】。 | 此时会弹出【！操作被取消】的窗口，其内容是：<br/>执行动作时出错：vm_b：<ul><li>无法运行虚拟机。没有满足当前调度约束的主机。请查看下面的细节：</li><li>主机 【host_B】 不满足 internal 过滤器 PinToHost。</li><li>主机 【host_A】 不满足 internal 过滤器 VmAffinityGroups，原因是不匹配非关联规则 。</li></ul> | 与预期结果一致。 |
| 0080511 | 在不考虑主机内存，CPU 使用紧张的情况下，验证具有【Negative + Soft Enforcement】属性的关联组下的两台虚拟机，且其中一台正运行在【主机A】上，将另一台正处于关闭状态且不可迁移的虚拟机设置为在【主机A】下开启，结果该虚拟机确实在【主机A】上成功开启。 | 1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 不勾选 【Positive】 和 【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择【虚拟机b】，点击【确定】。<br/>6. 编辑【虚拟机b】，在左侧的标签栏中选择【主机】，点击【专有的】，选择【主机A】。点击【迁移选项】的下拉菜单，选择【不允许迁移】。点击【确定】。<br/>7. 开启【虚拟机b】。 | 【虚拟机b】并没有在其它非【主机A】上开启，而是在【主机A】上成功开启。 | 与预期结果一致。 |
| 0080512 | 验证具有【Positive + Hard Enforcement】属性的关联组下的两台虚拟机且其中有一台处于关机状态且可以迁移的虚拟机由于一些特殊原因（例如：内存过大，超出了另一虚拟机所在的主机可以承受的范围）以至于不能在任何一台主机上正常启动。 | 测试前提条件：【虚拟机b】由于内存过大不能在【主机A】上开启，但是可以在【主机B】上开启。<br/>1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 勾选【Positive】 和 【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择【虚拟机b】，点击【确定】。<br/>6. 编辑【虚拟机b】，在左侧的标签栏中选择【主机】，点击【集群里的任何主机】。点击【迁移选项】的下拉菜单，选择【允许手动和自动迁移】。点击【确定】。<br/>7. 开启【虚拟机b】。 | 【虚拟机b】没有在任何一台主机上启动。 | 与预期结果一致。 |
| 0080513 | 验证具有【Positive + Soft Enforcement】属性的关联组下的两台虚拟机且其中有一台处于关机状态且可以迁移的的虚拟机由于一些特殊原因（例如：内存过大，超出了另一台虚拟机所在的主机可以承受的范围）不能在另一台运行着的虚拟机上所在的那台主机上启动，即而选择集群中另一个主机来作为自己的目的主机。 | 测试前提条件：【虚拟机b】由于内存过大不能在【主机A】上开启，但是可以在【主机B】上开启。<br/>1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 勾选【Positive】，不勾选 【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择【虚拟机b】，点击【确定】。<br/>6. 编辑【虚拟机b】，在左侧的标签栏中选择【主机】，点击【集群里的任何主机】。点击【迁移选项】的下拉菜单，选择【允许手动和自动迁移】。点击【确定】。<br/>7. 开启【虚拟机b】。 | 【虚拟机b】先是在【主机A】上启动，没有启动成功，即而在【主机B】上启动，并成功开启。 | 与预期结果一致。|
| 0080514 | 验证具有【Negative + Hard Enforcement】属性的关联组下的两台虚拟机且其中有一台处于关机状态且可以迁移的虚拟机由于一些特殊原因（例如：内存过大，超出了除另一虚拟机所在的主机之外的其它主机所能承受的范围）以至于不能在任何一台主机上正常启动。 | 测试前提条件：【虚拟机b】由于内存过大不能在【主机B】上开启，但是可以在【主机A】上开启。<br/>1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 不勾选【Positive】 ，勾选【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择【虚拟机b】，点击【确定】。<br/>6. 编辑【虚拟机b】，在左侧的标签栏中选择【主机】，点击【集群里的任何主机】。点击【迁移选项】的下拉菜单，选择【允许手动和自动迁移】。点击【确定】。<br/>7. 开启【虚拟机b】。 | 【虚拟机b】没有在任何一台主机上启动。 | 与预期结果一致。 |
| 0080515 | 验证具有【Negative + Soft Enforcement】属性的关联组下的两台虚拟机且其中有一台处于关机状态且可以迁移的的虚拟机由于一些特殊原因（例如：内存过大，超出了另一台虚拟机所在的主机可以承受的范围）不能在另一台运行着的虚拟机上所在的那台主机上启动，即而选择集群中另一个主机来作为自己的目的主机。 | 测试前提条件：【虚拟机b】由于内存过大不能在【主机B】上开启，但是可以在【主机A】上开启。<br/>1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 不勾选【Positive】和 【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择【虚拟机b】，点击【确定】。<br/>6. 编辑【虚拟机b】，在左侧的标签栏中选择【主机】，点击【集群里的任何主机】。点击【迁移选项】的下拉菜单，选择【允许手动和自动迁移】。点击【确定】。<br/>7. 开启【虚拟机b】。 | 【虚拟机b】先是在【主机B】上启动，没有启动成功，即而在【主机B】上启动，并成功开启。 | 与预期结果一致。 |  |
| 0080516 | 验证具有【Positive + Hard Enforcement】属性的关联组下的两台运行在同一集群的不同主机上的虚拟机可以通过迁移的方式运行在同一个主机上。 | oVirt 3.6 中的新特性，参见：http://www.ovirt.org/Affinity_Rules_Enforcement_Manager |
| 0080517 | 验证具有【Positive + Soft Enforcement】属性的关联组下的两台运行在同一集群的不同主机上的虚拟机可以通过迁移的方式运行在同一个主机上。 |  |  | oVirt 3.6 中的新特性，参见：http://www.ovirt.org/Affinity_Rules_Enforcement_Manager |
| 0080518 | 验证具有【Positive + Hard Enforcement】属性的关联组下的三台虚拟机，其中两台分别运行在同一集群的不同主机中，如果没有对处于关机状态的第三台虚拟机设定启动主机的话，这台虚拟机会在其它两台虚拟机所在的主机中的任意一个中运行。 | 1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/> 2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 勾选【Positive】和【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择运行在【主机B】中的【虚拟机b】；再点击【+】按扭，在下拉菜单中选择【虚拟机c】，点击【确定】。<br/>6. 编辑【虚拟机c】，在左侧的标签栏中选择【主机】，点击【集群里的任何主机】。点击【迁移选项】的下拉菜单，选择【允许手动和自动迁移】。点击【确定】。<br/>7. 开启【虚拟机c】。 | 【虚拟机c】会在【主机A】或者【主机B】中的任意一台主机上启动。 | 与预期结果一致。 | |
| 0080519 | 验证具有【Positive + Hard Enforcement】属性的关联组下的三台虚拟机，其中两台分别运行在同一集群的不同主机中，如果对处于关机状态的第三台虚拟机设定启动主机为除了其它两台虚拟机所在主机之外的主机，且允许迁移的话，虚拟机将在其余两台虚拟机所在的主机上启动。 | 1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。<br/>4. 勾选【Positive】和【Enforcing】。<br/>5. 点击【+】按扭，在下拉菜单中选择运行在【主机B】中的【虚拟机b】；再点击【+】按扭，在下拉菜单中选择【虚拟机c】，点击【确定】。<br/>6. 编辑【虚拟机c】，在左侧的标签栏中选择【主机】，点击【专有的】，在旁边的下拉菜单中选择【主机C】。点击【迁移选项】的下拉菜单，选择【允许手动和自动迁移】。点击【确定】。<br/>7. 开启【虚拟机c】。 | 【虚拟机c】会在【主机A】或者【主机B】上启动。 | 与预期结果一致。 |
| 0080520 | 验证具有【Positive + Hard Enforcement】属性的关联组下的三台虚拟机，其中两台分别运行在同一集群的不同主机中，如果对处于关机状态的第三台虚拟机设定启动主机为其它两台虚拟机所在主机中的任意一个主机的话，虚拟机将会在设定的主机中运行。 | 1. 点击【虚拟机】标签，选择一台运行在【主机A】上的【虚拟机a】。<br/>2. 在下面的子标签中选择 【Affinity 组】这个标签并点击【新建】按扭，会弹出【新建 Affinity 组】。<br/>3. 在【名称】旁边的输入框中输入该 Affinity 组的名称。4. 勾选【Positive】和【Enforcing】。<br/>4. 点击【+】按扭，在下拉菜单中选择运行在【主机B】中的【虚拟机b】；再点击【+】按扭，在下拉菜单中选择【虚拟机c】，点击【确定】。<br/>5. 编辑【虚拟机c】，在左侧的标签栏中选择【主机】，点击【专有的】，在旁边的下拉菜单中选择【主机A】/【主机B】。点击【迁移选项】的下拉菜单，选择【允许手动和自动迁移】。点击【确定】。<br/>6. 开启【虚拟机c】。 | 【虚拟机C】在【主机A】/【主机B】上成功启动。 | 与预期结果一致。 | | 
