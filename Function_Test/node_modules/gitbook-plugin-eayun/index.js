var cheerio = require('cheerio');
var _ = require('underscore');

var modBlockQuote = function(section) {

    var $ = cheerio.load(section.content);

    $('blockquote').each(function(i, elem) {
        if ($(elem).children().first().has('strong')[0]) {
            $(elem).replaceWith('<div class="note">' + $(elem) + '</div>');
        }
    });
    section.content = $.html();
};

module.exports = {
    book: {
        assets: "./book",
        css: [
            "eayun.css"
        ]
    },
    hooks: {
        "page": function(page) { // before html generation

            sections = _.select(page.sections, function(section) {
                return section.type == 'normal';
            });

            _.forEach(sections, modBlockQuote);
            return page;
        }
    }
};
