# 内存优化

| **编号** | **测试项** | **测试目的** | **测试步骤** | **预期结果** | **实际结果** |
|--------- | ---------- | ------------ | ------------ | ------------ | ------------ |
| 0010034 | 不选择**内存优化** | 验证在没有任何内存优化的情况下，主机能够使用的最大内存和主机的系统内存相等。 | 1. 选择**集群**选项卡，点击**新建**。<br/>2. 弹出**新建集群**这个弹出框。<br/>3. 为该集群输入**名称**；选择相应的 **CPU 类型**。<br/>4. 导航到侧边栏的**优化**标签。<br/>5. 选择**内存优化**中的**无 - 禁用内存页面共享**。<br/>6. 点击**确定**。<br/>7. 点击刚刚新建好的**集群**，点击**引导操作**，弹出**新建集群-引到操作**的弹出框。<br/>8. 点击**添加另外一台主机**，弹出**新建主机**弹出框。<br/>9. 输入已准备好的主机的**名称**，**地址**和**密码**。<br/>10. 点击**确定**。<br/>11. 稍等片刻，主机变为**Up**状态时，点击**虚拟机**选项卡。<br/>12. 点击**新建虚拟机**，弹出**新建虚拟机**弹出框，为虚拟机选择刚刚新建的**集群**，输入虚拟机**名称**。<br/>13. 导航到侧边栏的**系统**标签，输入和该主机内存大小相同的内存大小。<br/>14. 点击**确定**，并点击运行按钮来运行虚拟机。 | 虚拟机成功运行。 || 
| 0010035 | 不选择**内存优化** | 验证在没有任何内存优化的情况下，主机能够使用的最大内存和主机的系统内存相等。 | 1. 选择**集群**选项卡，点击**新建**。<br/>2. 弹出**新建集群**这个弹出框。<br/>3. 为该集群输入**名称**；选择相应的 **CPU 类型**。<br/>4. 导航到侧边栏的**优化**标签。<br/>5. 选择**内存优化**中的**无 - 禁用内存页面共享**。<br/>6. 点击**确定**。<br/>7. 点击刚刚新建好的**集群**，点击**引导操作**，弹出**新建集群-引到操作**的弹出框。<br/>8. 点击**添加另外一台主机**，弹出**新建主机**弹出框。<br/>9. 输入已准备好的主机的**名称**，**地址**和**密码**。<br/>10. 点击**确定**。<br/>11. 稍等片刻，主机变为**Up**状态时，点击**虚拟机**选项卡。<br/>12. 点击**新建虚拟机**，弹出**新建虚拟机**弹出框，为虚拟机选择刚刚新建的**集群**，输入虚拟机**名称**。<br/>13. 导航到侧边栏的**系统**标签，输入和该主机内存大小相同的内存大小。<br/>14. 点击**确定**，并点击运行按钮来运行虚拟机。<br/>15. 按照步骤 12~14，再创建一台相同的虚拟机，并开启它。| 虚拟机成功运行。 |
| 0010036 | 不选择**内存优化** | 测试不选择**内存优化**能够运行的虚拟机资源上限。| 1. 新建一个集群。<br/>2. 编辑集群：<ul><li>1. 导航到侧边栏的**优化**标签。</li><li>2. 选择**内存优化**中的**无 - 禁用内存页面共享**。</li><li>3. 点击**确定**。</li></ul>3. 为该集群添加一台主机，名称为 new\_host。<br/>4. 新建一台虚拟机，设置**保证的物理内存**大小为 <img src="http://192.168.2.222/cgi-bin/mathtex.cgi? \large m_{new}"> （MB），并在刚添加的主机上面运行。 | 假设主机物理内存为 h （MB），主机上正在运行 a 台虚拟机，第 n （n 为 1~a 的整数） 台虚拟机的内存为 <img src="http://192.168.2.222/cgi-bin/mathtex.cgi? \large m_{n}"> （MB），那么，若 <br/><img src="http://192.168.2.222/cgi-bin/mathtex.cgi? \large h <= 65 + \sum_{n=0}^a(m_n+65) + 65 + 321 + m_{new}"><br/>，虚拟机则可以运行，否则虚拟机运行失败，弹出错误提示框提示框，内容为：**主机 new_host 不满足 internal 过滤器 Memory，原因是没有足够的空闲内存来运行虚拟机。** ||
| 0010037 | 选择**内存优化**中的**用于服务器负载 - 设置页面共享为 150%** | 测试选择**内存优化**中的**用于服务器负载 - 设置页面共享为 150%**能够运行的虚拟机资源上限。| 1. 新建一个集群。<br/>2. 编辑集群：<ul><li>1. 导航到侧边栏的**优化**标签。</li><li>2. 选择**内存优化**中的**无 - 禁用内存页面共享**。</li><li>3. 点击**确定**。</li></ul>3. 为该集群添加一台主机，名称为 new\_host。<br/>4. 新建一台虚拟机，设置**保证的物理内存**大小为 <img src="http://192.168.2.222/cgi-bin/mathtex.cgi? \large m_{new}"> （MB），>并在刚添加的主机上面运行。 | 假设主机物理内存为 h （MB），主机上正在运行 a 台虚拟机，第 n （n 为 1~a 的整数） 台虚拟机的内存为 <img src="http://192.168.2.222/cgi-bin/mathtex.cgi? \large m_{n}"> （MB），那么，若 <br/><img src="http://192.168.2.222/cgi-bin/mathtex.cgi? \large 1.5h <= 65 + \sum_{n=0}^a(m_n+65) + 65 + 321 + m_{new}"><br/>，虚拟机则可以运行，否则虚拟机运行失败，弹出错误提示框提示框，内容为：**主机 new_host 不满足 internal 过滤器 Memory，原因是没有足够的空闲内存来运行虚拟机。** || 
| 0010038 |  | 
| 0010039 |  |
| 0010040 | 选择**内存优化**中的**用于桌面负载 - 设置页面共享为 200%** | 测试选择**内存优化**中的**用于桌面负载 - 设置页面共享为 200%**能够运行的虚拟机资源上限。| 1. 新建一个集群。<br/>2. 编辑集群：<ul><li>1. 导航到侧边栏的**优化**标签。</li><li>2. 选择**内存优化**中的**无 - 禁用内存页面共享**。</li><li>3. 点击**确定**。</li></ul>3. 为该集群添加一台主机，名称为 new\_host。<br/>4. 新建一台虚拟机，设置**保证的物理内存**大小为 <img src="http://192.168.2.222/cgi-bin/mathtex.cgi? \large m_{new}"> （MB），>并在刚添加的主机上面运行。 | 假设主机物理内存为 h （MB），主机上正在运行 a 台虚拟机，第 n （n 为 1~a 的整数） 台虚拟机的内存为 <img src="http://192.168.2.222/cgi-bin/mathtex.cgi? \large m_{n}"> （MB），那么，若 <br/><img src="http://192.168.2.222/cgi-bin/mathtex.cgi? \large 2h <= 65 + \sum_{n=0}^a(m_n+65) + 65 + 321 + m_{new}"><br/>，虚拟机则可以运行，否则虚拟机运行失败，弹出错误提示框提示框，内容为：**主机 new_host 不满足 internal 过滤器 Memory，原因是没有足够的空闲内存来运行虚拟机。** ||
| 0010041 |  |
| 0010042 |  |
