-------

##测试点1：集群的操作   

####实验说明：    
本实验是对EayunOS 4.1的集群的基础操作。这个实验的目标是创建一个新的集群，让其管理属于这个集群的主机。让集群中的虚拟机可以在该集群中的主机上自由迁移。      
####实验目标：新建集群

####预置条件：必须有一个数据中心，默认的数据中心也算。

####预期结果：创建集群成功。    

####测试步骤：   
 
  &nbsp;   &nbsp;  &nbsp;1. 可以在创建完数据中心后，在【新建数据中心-引导操作】中点击【配置集群】来创建集群；如果点击了【以后再配置】，则可以点击数据中心菜单中的【引导操作】，重新打开该窗口，点击【配置集群】；或点击树形面板中的【展开所有】按键，选择默认数据中心的集群，在其菜单中点击【新建】按键 。    
  &nbsp;   &nbsp;  &nbsp;2.在弹出的【新建集群】窗口中，可以对左侧选项进行一一配置，在本实验中，配置如下： 

    在【常规】标签中输入名称、描述、注释，选择CPU类型为Intel SandyBridge Family，其他保持默认配置
    在【优化】标签中设置内存优化、CPU线程、内存Balloon、KSM控件（新的），使用默认配置
    在【Resilience策略】标签中选择【移植虚拟机】的策略
    在【集群策略】和【控制台】标签下的配置使用默认配置
    在【隔离策略】标签下，勾选Enable Fencing     
&nbsp;   &nbsp;  &nbsp;3.点击【确定】，集群新建成功，仍然显示【新建数据中心-引导虚拟机的创建和使用 操作】窗口，可以点击【以后再配置】跳过剩下的操作，也可以继续进行（如果是直接在集群标签下新建，则没有【新建数据中心-引导操作】的窗口显示，会返回集群列表中）。

####测试结果：创建集群成功。      

---
####实验目标： 配置网络之在集群上配置网络 

####预置条件：新建一个数据中心并且没有配置逻辑网络。

####预期结果：网络配置成功    

####测试步骤：     
1.在左侧树形面板中点击【展开所有】按键，点击选择【数据中心】，在右侧的详细列表中显示数据中心，选择所创建的数据中心，点击【逻辑网络】子标签，点击【新建】按键    
2.在弹出的【新建逻辑网络】窗口中，输入名称（必填）、描述和注释（选填），其他配置使用默认配置
点击【确定】，完成逻辑网络的创建 

####测试结果：网络配置成功

----
####实验目标： 配置网络之在主机上配置网络 

####预置条件：必须有一个数据中心、一个集群，默认的也算，主机添加成功后。

####预期结果：主机网络网络配置成功    

####测试步骤：   
1.在左侧树形面板中点击【展开所有】按键，点击选择【主机】，在右侧的详细列表中显示主机列表，选择一台主机    
2.点击【网络接口】子标签，点击【设立主机网络】，在弹出的【设立主机网络】窗口中，将右侧的所新建的网络拖动到主机的网卡上，点击【确定】   
3.为主机添加网络成功 
####测试结果：主机网络配置成功。
----     
####实验目标：编辑集群    
####预置条件：有一个创建好的集群。
####预期结果：编辑集群成功    
####测试步骤：    
  &nbsp;   &nbsp;  &nbsp;1.点击树形面板中的【展开所有】按键，选择默认数据中心的集群，在其菜单中点击【编辑】按键 。      
  &nbsp;   &nbsp;  &nbsp;2.在弹出的【编辑集群】窗口中，可以对左侧选项进行一一配置，在本实验中，配置如下： 

    在【常规】标签中修改名称、描述、注释，选择CPU类型为Intel SandyBridge Family，其他保持默认配置
    在【优化】标签中设置内存优化、CPU线程、内存Balloon、KSM控件（新的），使用默认配置
    在【Resilience策略】标签中选择【移植虚拟机】的策略
    在【集群策略】和【控制台】标签下的配置使用默认配置
    在【隔离策略】标签下，勾选Enable Fencing           
####测试结果：编辑集群成功      
----
####实验目标：删除集群    
####预置条件：有一个创建好的集群。并且这个集群里没有运行的虚拟机，同时也没有别的功能在依赖这个集群。
####预期结果：删除集群成功    
####测试步骤：    
  &nbsp;   &nbsp;  &nbsp;1.点击树形面板中的【展开所有】按键，选择默认数据中心的集群，在其菜单中点击【删除】按键 。      
  &nbsp;   &nbsp;  &nbsp;2.在弹出的【删除集群】窗口中，点击【确定】，集群被删除。    
####测试结果：删除集群成功
  ----     
####实验目标：创建Affinity组
####预置条件：有一个创建好的集群。
####测试步骤：    
  &nbsp;   &nbsp;  &nbsp;1.选中创建好的集群，在下方面板中选择Affinity组。点击【新建】，在新建Affinity组选项卡中输入名称、描述。点击【确定】。
####测试结果：Affinity组创建成功。
----
####实验目标：删除Affinity组
####预置条件：有一个创建好的集群和一个创建好的Affinity组。
####测试步骤：    
&nbsp;   &nbsp;  &nbsp;1.选中创建好的集群，在下方面板中选择Affinity组。点击【删除】，在删除Affinity组面板中点击【确定】，Affinity组被删除。
####测试结果：Affinity组删除成功
虚拟机的创建和使用 
####本章小结：在这章里我们学会了集群的创建，编辑，以及删除。没有发现预期结果和测试结果不通的地方，测试通过。     
 -----      
##主机的操作    
####实验说明：    
主机,也被称作宿主机,是供虚拟机在其之上运行的物理服务器。 EayunOS 中的虚拟化是由
KVM(Kernel-based Virtual Machine) 这个可动态加载的 Linux 内核模块提供的。
KVM 能够同时支持多个虚拟机,虚拟机之上的系统可以是 Windows 或者 Linux。虚拟机在主机之中是
以 Linux 进程和线程的存在形式运行着,并且由 EayunOS 虚拟化管理中心进行远程管理。 EayunOS 环
境中存在一个或者多个主机。
EayunOS 支持使用两种方式来安装主机。您可以使用 EayunOS 主机安装光盘,或者在一台标准的
RHEL/CentOS 之上安装主机所需要的软件包,来完成主机的安装。
EayunOS 主机可以使用针对虚拟化环境提供优化策略的 tuned 来进行配置,从而提高主机性能。关于
tuned 的更多信息,请参考 RHEL 文档中的相关章节。     

####实验目标：创建一个新的主机
####预置条件：在创建完数据中心和集群的基础上创建主机。
####预期结果：主机创建成功
####测试步骤：
  &nbsp;   &nbsp;  &nbsp;1.可以在创建完数据中心后显示的“创建数据中心-引导操作”对话框内直接配置主机。若没有直接配置主机则在EayunOS虚拟化平台选择新创建的数据中心，点击【引导操作】，在这个对话框点击【配置主机】。         
  &nbsp;   &nbsp;  &nbsp;2.配置：

    在“常规”列表内输入“名称”及“注释”、“主机地址”、“密码”其它选项可以保留默认设置，在“在高级参数”下获取指纹，同时取消“自动配置主机防火墙”。
    在“电源管理”列表内勾选“启用电源管理”后，输入“地址”、“用户名”、“密码”、“类型”这里设置为ipmilan，点击【测试】，显示测试成功。
    在“SPM”列表内设置“SPM优先级”，默认设置“正常”。
    在“控制台”项，保留默认设置。
    在“网络供应商”项，保留默认设置。   
  &nbsp;   &nbsp;  &nbsp;3.点击【确定】。在EayunOS虚拟化管理平台左侧树形面板，点击【展开所有】，选择主机，主机显示在主机列表内，状态“Installing->Reboot->Waiting->Up”。    
  &nbsp;   &nbsp;  &nbsp;4.主机安装完成可以使用时，状态为“Up”。  
####测试结果：主机创建成功。  
----       
##虚拟机的操作
####实验说明：    
虚拟机指通过软件模拟的具有完整硬件系统功能的计算机系统。目前 EayunOS 管理 系统允许用户创建
两种形式的虚拟机,虚拟桌面和虚拟服务器。
虚拟机使得管理和利用计算机更加简单快捷。传统的计算环境要求每一个计算任务在 独立的硬件资源下
运行,通过使用虚拟机,可以更有效地利用硬件资源,并且,管理 上也更便捷。    
####实验目标：新建Red Hat系列的虚拟机 
####预置条件：在进行该实验之前，你的虚拟化系统已经有至少一台可用于运行虚拟机的主机和一个包含有ISO镜像的ISO域。本实验以安装CentOS系统为例
####预期结果：虚拟机新建成功。
####测试步骤：
  &nbsp;   &nbsp;  &nbsp;1.在EayunOS管理平台树形面板先点击【展开所有】（按键，在默认的数据中心下的默认集群，点击【虚拟机】，在虚拟机列表下，点击【新建虚拟机】，输入名称、设置内存（本实验设置10GB）、设置操作系统（本实验设置Red Hat Enterprise Linux6.x 64）,你可以根据实际改变其它选项，本实验选择保留默认设置，点击【确定】。    
  &nbsp;   &nbsp;  &nbsp;2.设置磁盘大小（本实验设置8GB），其它项保留默认设置，点击【确定】  。    
  &nbsp;   &nbsp;  &nbsp;3.点击【稍后配置】，关闭该窗口，新建的虚拟机显示在虚拟机列表里 。    
  &nbsp;   &nbsp;  &nbsp;4.在虚拟机列表下，找到新创建的虚拟机，选中该虚拟机，点击【只运行一次】, 选择【引导选项】->【附加CD】，选择iso,将CD-ROM置于顶部，点击【控制台】，在协议那里选择【VNC】，点击【确定】。     
  &nbsp;   &nbsp;  &nbsp;5.虚拟机运行，点击【控制台】绿色的电脑图标，进入虚拟机，安装操作系统 。         
&nbsp;   &nbsp;  &nbsp;6.操作系统安装完成后，点击【修改CD】，将光盘弹出 。    
 &nbsp;   &nbsp;  &nbsp;7.在创建的虚拟机的详细面板下，点击【网络接口】，点击【新建】,输入名称，选择配置，本实验保留默认配置，点击【确定】 。


####测试结果：虚拟机新建成功。    
---
##测试点：虚拟机的创建和使用 
####测试目标：创建EL7虚拟机    
####预置条件：在进行该实验之前，你的虚拟化系统已经有至少一台可用于运行虚拟机的主机和一个包含有ISO镜像的ISO域。
####预期结果：虚拟机创建成功，可以运行。
####测试步骤：    
  &nbsp;   &nbsp;  &nbsp;1.在EayunOS管理平台树形面板先点击【展开所有】在默认集群的Default下，点击虚拟机，在右侧的虚拟机列表中，点击菜单中的【新建虚拟机】按键，在弹出的【新建虚拟机】窗口中，选择基于模板【EL7】，输入虚拟机名称（必填）、描述和注释（选填），点击【确定】 。   
  &nbsp;   &nbsp;  &nbsp;2. 弹出【新建虚拟机-引导操作】窗口，点击【配置虚拟磁盘】在弹出的【添加虚拟磁盘】窗口中，输入大小磁盘大小，其他保持默认配置，点击【确定】（ok），磁盘状态变化为Locked -> Up  
#### 
在默认集群的Default下，点击虚拟机，在右侧的虚拟机列表中，点击菜单中的【新建虚拟机】按键    
&nbsp;   &nbsp;  &nbsp;2.在弹出的【新建虚拟机】窗口中，选择基于模板【EL7】，输入虚拟机名称（必填）、描述和注释（选填），点击【确定】   
#####创建虚拟机只读磁盘 
    1.点击左侧树形面板中的【展开所有】（Expend All），在默认集群的Default下，点击虚拟机，在右侧的虚拟机列表中，选择所要添加磁盘的虚拟机
    2.点击下方的【磁盘】子标签，点击菜单中的【添加】按键，在弹出的【添加虚拟磁盘】窗口中，输入磁盘大小，勾选右侧的【只读的】，将磁盘设置为只读，点击【确定】（ok）
    3.虚拟机新建成功，带有一个磁盘，磁盘状态变化为Locked -> Up     
####测试结果：虚拟机创建成功
----
####测试目标：创建Debian7虚拟机     
####预置条件：在进行该实验之前，你的虚拟化系统已经有至少一台可用于运行虚拟机的主机和一个包含有ISO镜像的ISO域。
####预期结果：虚拟机创建成功，可以运行。
####测试步骤：
     1.登录到Engine管理端，点击左侧树形面板中的【展开所有】（Expend All），在默认集群的Default下，点击虚拟机，在右侧的虚拟机列表中，点击菜单中的【新建虚拟机】按键
     2.弹出【新建虚拟机】窗口，选择【操作系统】为Debian 7，输入虚拟机的名称（必填）、描述和注释（选填），其他保持默认配置，点击【确定】（ok）
     3.弹出【新建虚拟机-引导操作】窗口，点击【配置虚拟磁盘】
     4.在弹出的【添加虚拟磁盘】窗口中，输入大小磁盘大小，其他保持默认配置，点击【确定】（ok）
     5.磁盘状态变化为Locked -> Up 
#####创建虚拟机只读磁盘 
     1.点击左侧树形面板中的【展开所有】（Expend All），在默认集群的Default下，点击虚拟机，在右侧的虚拟机列表中，选择所要添加磁盘的虚拟机
    2.点击下方的【磁盘】子标签，点击菜单##测试点：虚拟机的创建和使用 中的【添加】按键，在弹出的【添加虚拟磁盘】窗口中，输入磁盘大小，勾选右侧的【只读的】，将磁盘设置为只读，点击【确定】（ok）
    3.虚拟机磁盘新建成功，磁盘状态变化为Locked -> Up 
####测试结果：虚拟机创建成功
-----
##测试点：创建Linux虚拟机模板  
####测试目标：创建EL7虚拟机模板     
####预置条件：在进行该实验之前，你的虚拟化系统已经有至少一台可用于运行虚拟机的主机和一个包含有ISO镜像的ISO域。包括一台EL7虚拟机。
####预期结果：模版创建成功，可以基于模版创建虚拟机。
####测试步骤：    
 1.登录到Engine管理端，点击左侧树形界面中的【展开所有】（Expend All），在默认集群的Default下，点击虚拟机，在右侧的虚拟机列表中，点击菜单中的【新建虚拟机】按键    
 2.在弹出的【新建虚拟机】窗口中，选择基于模板【EL7】，输入虚拟机名称（必填）、描述和注释（选填），点击【确定】    
 3.虚拟机创建成功，状态变化为image Locked -> Up，其磁盘状态变化为Locked -> Up      
####测试结果：模版创建成功，可以基于模版创建虚拟机。
----
##测试点：创建虚拟机快照  
####测试目标：创建虚拟机快照    
####预置条件：需要一台创建好的虚拟机。
####预期结果：创建虚拟机快照成功
####测试步骤：
1. 选择要创建快照的虚拟机，该虚拟机可以是Down的状态，也可以是Up的状态
2.点击菜单中的【创建快照】按键，或点击该虚拟机下的【磁盘】子标签，点击其菜单中的【创建】按键
3.在弹出的【创建快照】窗口中，输入该快照的描述，其他保留默认配置，点击【确定】
4.快照创建成功，快照的状态为Ok
5.选择快照，能再右侧的小窗口中看到快照的一些信息，包括【常规】【磁盘】【网络接口】【已安装的应用程序】 
####测试结果：创建虚拟机快照成功
-----
##测试点：克隆虚拟机  
####测试目标：直接克隆虚拟机    
####预置条件：需要一台创建好的虚拟机。
####预期结果：克隆虚拟机成功。
####测试步骤：
1.选择一台虚拟机，点击菜单中的关闭图标或右键选择【关闭】，关闭该虚拟机，虚拟机的状态变化为Powering Down -> Down           
2.点击菜单中的【克隆VM】按键或右键选择【克隆VM】    
3.在弹出的【克隆虚拟机】窗口中，输入克隆名称，点击【确定】    
4.虚拟机创建成功，虚拟机的状态为Down，点击菜单中的运行图标或右键选择【运行】，运行虚拟机，该虚拟机的配置和被克隆的虚拟机相同 
####测试结果：克隆虚拟机成功。
----
##测试点：从虚拟机快照中克隆虚拟机  
####测试目标：直接克隆虚拟机    
####预置条件：需要一个克隆好的虚拟机快照。
####预期结果：从虚拟机快照克隆虚拟机成功。
####测试步骤：
1.选择要克隆的虚拟机，点击虚拟机的【快照】子标签   
2.在【快照】子标签中列出了该虚拟机的所有快照，选择一个非当前的快照（当前快照不可以克隆），点击子菜单中的【克隆】按键    
3.在弹出的【从快照中克隆虚拟机】窗口中，输入虚拟机的名称（必填）、描述和注释（选填），其他配置可以根据需要进行修改（操作系统不可更改）    
4.点击【确定】，虚拟机创建成功，虚拟机状态变化为image Locked -> Down    
5.点击菜单中的运行图标或右键选择【运行】，可以运行该虚拟机 
####测试结果：从虚拟机快照克隆虚拟机成功。
----
##测试点：虚拟机的迁移  
####测试目标：虚拟机的动态迁移  
####预置条件：新建一台允许迁移的虚拟机，集群中至少有俩台可用主机.由其中的一台迁移往另外的一台主机。
####预期结果：虚拟机由其中一台主机迁移向另外一台主机。
####测试步骤：    
1.登录到Engine管理端后，点击左侧树形面板中的【展开所有】按键，在默认数据中心下点击默认集群，点击【集群】下的【虚拟机】   
2.在右侧虚拟机列表中显示所有可用的虚拟机，选择一台允许迁移的虚拟机，点击菜单中的【移植】按键或右键选择【移植】    
3.弹出【移植虚拟机】的窗口，可以选择【自主选择主机】，让虚拟机自主选择一台可迁移的主机；也可以【选择目的主机】，将虚拟机迁移到指定的主机上，点击【确定】    
4.虚拟机开始迁移，虚拟机状态变化为Migrating -> Up，在虚拟机的【迁移】属性中能够显示虚拟机迁移的进度 
####测试结果:迁移成功
----
####测试目标： 迁移Engine虚拟机 
####预置条件：新建一台允许迁移的虚拟机，集群中至少有俩台可用主机.由其中的一台（默认为：hosted_engine_1）迁移往另外的一台主机。
####预期结果：虚拟机由其中一台主机迁移向另外一台主机。
####测试步骤：
1.登录到Engine管理端后，点击左侧树形面板中的【展开所有】按键，在默认数据中心下点击默认集群，点击【集群】下的【虚拟机】   
2.在右侧虚拟机列表中显示所有可用的虚拟机，选择HostedEngine虚拟机，点击菜单中的【移植】按键或右键选择【移植】    
3.弹出【移植虚拟机】的窗口，可以选择【自主选择主机】，让虚拟机自主选择一台可迁移的主机；也可以【选择目的主机】，将虚拟机迁移到指定的主机上，点击【确定】   
4.报错：    无法 迁移 VM。没有满足当前调度约束的主机。请查看下面的细节：
    主机 hosted_engine_1 不满足 internal 过滤器 Memory，原因是没有足够的空闲内存来运行虚拟机。
    主机 node_2.27 不满足 internal 过滤器 Memory，原因是没有足够的空闲内存来运行虚拟机。   
5.我去查看我的主机内存还有3G多。
####测试结果：迁移失败。    
----
####测试目标： 添加NFS存储  
####预置条件：添加主机成功，主机网络配置成功。
####预期结果：NFS存储添成功
####测试步骤：
1.下载NFS软件包:# yum install nfs-utils    
2.配置 NFS 开机启动:    # chkconfig --add rpcbind
                         # chkconfig --add nfs
                         # chkconfig rpcbind on
                        # chkconfig nfs on     
3.如果是第一次配置,需要手动把 nfs 服务启动: # service rpcbind start
                                              # service nfs start       
4.创建共享目录：（以 /export/good 为例子）
                    # mkdir /exports/good
                    # chown -R 36:36 /exports/good        
5.配置共享目录：打开 nfs 的配置文件---vi /etc/exports,添加一行 /exports/good * (rw)    
6.重载 NFS 服务：# service nfs reload       
7. 登录到Engine管理端，在左侧树形面板中点击【展开所有】按键，在默认数据中心的默认集群下点击选择【存储】   
8.在右侧的详细列表中，点击菜单中的【新建域】按键     
9.在弹出的【新建域】窗口中，选择域功能/存储类型为【Data/NFS】，输入域的名称（必填）、描述和注释（选填），选择使用主机，在导出路径中填写配置的NFS域的路径，格式为FQDN://path或IP://path，其他配置保持默认配置    
10.点击【确定】，NFS数据域创建成功，数据域的状态变化为Locked -> Active                                               
####测试结果：NFS存储添成功
----
####测试目标： 添加iSCSI数据域 
####预置条件：添加主机成功，主机网络配置成功。
####预期结果：iSCSI数据域存储添成功
####测试步骤：   
1.安装相关软件包：yum install -y scsi-target-utils   
2.编辑 /etc/tgt/targets.conf 文件,增加以下几行内容：    
                                                  \<target iqn.2014-03.com.example:server.target0>                                                                                                
                                                       backing-store /dev/sdb # LUN 1   
                                                        backing-store /dev/sdc # LUN 2
                                                       \</target>   
3.重启 tgtd 服务。    
  # service tgtd restart   
4.让 tgtd 服务开机启动.
  # chkconfig tgtd on    
5.如果配置了 iptables 防火墙,必须把 iSCSI 用来和客户端通信的端口(默认是 3260)打开  
  # iptables -I INPUT 6 -p tcp --dport 3260 -j ACCEPT   
6.保存 iptables 的配置 
  # service iptables save   
7.登录到Engine管理端，在左侧树形面板中点击【展开所有】按键，在默认数据中心的默认集群下点击选择【存储】  
8.在右侧的详细列表中，点击菜单中的【新建域】按键   
9.在弹出的【新建域】窗口中，选择域功能/存储类型为【Data/iSCSI】，输入域的名称（必填）、描述和注释（选填），选择使用主机   
10.在下方的窗口中，填写iSCSI的地址（可以使用IP也可以使用FQDN），端口为3260，点击【发现】    
11.在发现的目标列表中，选择一个要target，点击右侧的登录图标    
12.点击target前方的【+】图标，展开这个target下的所有LUN，勾选要添加的LUN，点击【确定】  
13.iSCSI数据域创建成功，数据域的状态变化为Locked -> Active  
####测试结果：iSCSI数据域存储添加成功
----
##虚拟桌面 
####测试目标： 创建并安装一个Windows虚拟机
####预置条件：数据中心、集群、主机、网络、存储都配置成功。
####预期结果：Windows    虚拟机系统启动成功
####测试步骤：   
1.登录到Engine管理端，在左侧树形面板中点击【展开所有】按键，在默认数据中心的默认集群下点击【虚拟机】，在右侧的虚拟机详细列表中，点击菜单中的【新建虚拟机】按键   
2.在弹出的【新建虚拟机】窗口中，选择操作系统为Windows 7 x64，优化选择为【桌面】输入虚拟机名称（必填），点击【控制台】选择协议【VNC】，其他配置保持默认配置，你也可以根据需要更改相关的配置   
3.点击【确定】后，弹出【新建虚拟机-引导操作】窗口，点击【配置虚拟机磁盘】为该虚拟机配置磁盘，在打开的【添加虚拟机磁盘】窗口中，输入添加磁盘的大小（测试用的是4G），其他配置保持默认配置，点击【确定】，回到【新建虚拟机-引导操作】窗口，点击【以后再配置】结束新建虚拟机磁盘操作，关闭窗口  
4.虚拟机创建成功，显示在虚拟机列表中，虚拟机状态变化为image Locked -> Down，虚拟机磁盘的状态变化为Locked -> Up    
5.选中刚才新建的Windows 7虚拟机，点击菜单中的【只运行一次】  
6.在弹出的【运行虚拟机】窗口中，勾选附加CD，选择Windows7的ISO镜像，在引导序列中，选择CD-ROM，点击【上移】，点击【确定】运行虚拟机    
7.当询问【您想将 Windows 安装在何处？】时，点击虚拟机菜单中的【更换CD】，选择ovirt-guest-tools.iso，点击【确定】     
8.点击【加载驱动程序】，在【选择要安装的驱动程序】窗口中，点击【浏览】，选择driver -> win7 -> x86（32位操作系统选择x86，64位操作系统选择amd64），点击【确定】   
9.选择【Red Hat VirtIO SCSI controller】，点击【下一步】，安装驱动程序   
10.安装驱动完成后，回到【您想将 Windows 安装在何处？】的窗口，点击虚拟机菜单中的【更换CD】，换回Windows7的安装镜像    
11.点击【下一步】后，继续安装Windows7操作系统    
12.等待，直到虚拟机操作系统安装完成，新用户输入用户名，进入系统     














